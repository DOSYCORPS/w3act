@(title: String, user: User, targets: List[Target], curators: List[User], searchurl: String)

@main(title, user){
    
    <h1>Look up a URL</h1>
    
    <article class="lookup">
		<div class="folder">
			<div class="row">
		        <div class="col-lg-6">	        
		          <div class="panel panel-primary" id="panels">
		            <div class="panel-heading">URL
		            </div>
				    <div class="panel-body">		            
				      <div id="forms">
				        <form class="filter-form" action="@routes.LookUp.filterUrl()" method="POST">
				            <div class="form-group">
					            <ul class="nav navbar-nav">
					              <li><input class="lookup-form-control" id="inputName" name="url" placeholder="http://www.bbc.co.uk" type="text" value="@searchurl"></li>
					              <li><button type="submit" class="btn btn-success" id="search" name="search"  title="Red color means that URL is not in scope, green color means that URL is in scope">Search</button></li>	
								  @if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
					              <li><button type="addentry" class="btn btn-success" id="addentry" name="addentry" title="Red color means that URL is not in scope, green color means that URL is in scope">Add Entry</button></li>
					              }	
					              <li><p class="urlsearchp">Enter URL to search for, e.g. 'http://www.bbc.co.uk'</p></li> 
				                </ul>  			              
				            </div>
				        </form>
				      </div>
				    </div>
		        </div>
		        <script>
			          var idle_timeout,
			          SCOPE_URI = '/api/scope',
			          MIN_TEXT_LENGTH = 4, // minimum length annotation must have before being allowed to the doScope server
			          TRIGGER_CHARS = ". ,", // characters that force an doScope lookup
			          IDLE_THRESHOLD = 500; // doScope is also done after IDLE_THRESHOLD milliseconds of key idleness
		          
			          // Does the Scope lookup
			          var doScope = function(text) {
			              $.getJSON(SCOPE_URI + text, function(data) {
			              //alert("Is in scope: " + data);
			              var btn = document.getElementById('addentry'); 
			              var btnsearch = document.getElementById('search'); 
			              if (data) {
				              btn.style = "background-color: hell-green";
				              btnsearch.style = "background-color: hell-green";
			              } else {
				              btn.style = "background-color: red";
				              btnsearch.style = "background-color: red";
			              }
			            });
			          };
			          
			          // Restarts the keyboard-idleness timeout
			          var restartIdleTimeout = function(text) {
			            if (idle_timeout)
			              window.clearTimeout(idle_timeout);
			            
			            idle_timeout = window.setTimeout(function() { doScope(text); }, IDLE_THRESHOLD);
			          };		
			          
					  $("#inputName").keyup(function() {
							var text = $('input[name=url]').val();
							
						    if (text.length > MIN_TEXT_LENGTH) {
						        restartIdleTimeout(text);
						
						    	if (TRIGGER_CHARS.indexOf(text[text.length - 1]) > -1)
						        	doScope(text);
						    }
					  });
				</script>		        
		        <div class="col-lg-6">
					<ul class="list">
					<!-- script >
							$(function() {
							$("table#urlsearchtable").tablesorter({ sortList: [[1,0]] });
							});
					</script>
					<table id="urlsearchtable" class="tablesorter table table-striped table-bordered table-condensed zebra-striped"-->
						<table id="lookuptable" class="table table-striped table-bordered table-hover table-condensed">
			              <thead>
			                <tr>
			                  <th>Title</th>
			                  <th>URL(s)</th>
			                  <th>Organisation</th>
			                  <th>Crawled URL(s)</th>
			                  <th>Crawl Frequency</th>
			                  <th>User</th>
			                  <th>QA Status</th>
			                  <th>In Scope</th>
			                  <th>Other Archives</th>
			                </tr>
			              </thead>
			              <tbody>
			              	@targets.map { target =>		              
			                <tr>
			                  <td><a class="brand" href="@routes.TargetEdit.view(target.url)">@target.title</a><br><a class="brand" href="@target.get_field_list_as_str("field_url")">@target.get_field_list_as_str("field_url")</a></td>
			                  <td><a class="brand" href="opera.bl.uk:/8080/wayback/*@target.get_field_list_as_str("field_url")">(mid-crawl),</a>
			                  	<a class="brand" href="http://www.webarchive.org.uk/bluebox/search.jsf?url=http://@target.get_field_list_as_str("field_url")">(archival),</a>
			                  	<a class="brand" href="@target.get_field_list_as_str("field_url")">(live)</a></td>
			                  @if(target.field_nominating_organisation != null 
			                  	&& Organisation.findByUrl(target.field_nominating_organisation).url != null
			                  	&& Organisation.findByUrl(target.field_nominating_organisation).title != null) {
			                  	<td><a href="@routes.OrganisationEdit.view(Organisation.findByUrl(target.field_nominating_organisation).url)">
			                  		@Organisation.findByUrl(target.field_nominating_organisation).title</a></td>
			                  } else {
			                    <td></td>
			                  }
		                      <td>0</td>
			                  <td>@target.field_crawl_frequency</td>
			                  <td><a class="brand" href="@routes.UserEdit.edit(target.author)">@target.get_user_by_id()</a></td>
			                  <td>QA issue</td>
			                  <td>@target.checkScope(target.get_field_list_as_str("field_url"))</td>
			                  <td><a class="brand" href="http://www.webarchive.org.uk/mementos/search/http://@target.get_field_list_as_str("field_url")">(mementos)</a></td>
			                </tr>
			                }
			              </tbody>
			            </table>		          	
        		    </ul>
		        </div>		          
	          </div>
		  </div>
		</div>
    </article>
    
}

