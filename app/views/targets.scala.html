@(title: String, user: User, targets: List[Target], curators: List[User], organisations: List[Organisation], curatorUrl: String, organisationUrl: String, collectionCategoryUrl: String, subjectUrl: String, crawlFrequency: String, depth: String, scope: String, offset: Int, limit: Int)

@pagination = {
  <div class="row">
    <div class="col-lg-6">
        <ul class="pagination" style="margin-right: 10px; width: 600px;">
          @if(Targets.checkPrev(offset)) {
          <li>
            <a class="page" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
            	subjectUrl, crawlFrequency, depth, scope, Targets.getPrev(Targets.getStartPage(offset)), limit)">Prev</a>
          </li>
          }
          @for(i <- Targets.getRange(Targets.getStartPage(offset))) {
              @if(Targets.checkNext(i, limit)) {
              <li>
                <a class="page" @if(offset==i){style="color:red";}" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
                	subjectUrl, crawlFrequency, depth, scope, i, limit)">@(i+1)</a>
              </li>
              }
          }
          @if(Targets.checkNext(offset+Targets.getPaginationOffset(), limit)) {
          <li>
            <a class="page" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
            	subjectUrl, crawlFrequency, depth, scope, Targets.getNext(Targets.getStartPage(offset)), limit)">Next</a>
          </li>
          }
          <li>
            <a class="page" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
            	subjectUrl, crawlFrequency, depth, scope, Targets.getMaxPageNumber(limit)-1, limit)">
            	@Targets.getMaxPageNumber(limit)</a>
          </li>
		</ul>
		<!--p>Displayed page @(offset+1) from @Targets.getMaxPageNumber(limit)</p-->
      </div>
     </div>		          	
}

@main(title, user){
    
    <h1>Targets overview</h1>
    
    <article class="targets">
		<div class="folder">
			<div class="row">
		        <div class="col-lg-2">	        
		          <div class="panel panel-primary filter" id="panels">
		            <div class="panel-heading">Filter by search term:
		            </div>
				      <div id="forms">
				        <form class="filter-form" action="@routes.Targets.filterUrl()" method="POST">
				            <div class="form-group">
				              <input class="form-control" id="inputName" name="filter" type="text">
				            </div>
				            <button type="submit" class="btn btn-success">Search</button>
		                    <label id="isInScope" style="color: green"></label>
				        </form>
				      </div>
		          </div>
		          <script>
			          var idle_timeout,
			          SCOPE_URI = '/api/scope',
			          MIN_TEXT_LENGTH = 5, // minimum length annotation must have before being allowed to the doScope server
			          TRIGGER_CHARS = ". ,", // characters that force an doScope lookup
			          IDLE_THRESHOLD = 500; // doScope is also done after IDLE_THRESHOLD milliseconds of key idleness
		          
			          // Does the Scope lookup
			          var doScope = function(text) {
			              $.getJSON(SCOPE_URI + text, function(data) {
			              //alert("Is in scope: " + data);
			              var lab = document.getElementById('isInScope'); 
			              if (data) {
				              lab.innerHTML = "is in scope";
				              lab.style = "color: green";
			              } else {
				              lab.innerHTML = "is not in scope";
				              lab.style = "color: red";
			              }
			            });
			          };
			          
			          // Restarts the keyboard-idleness timeout
			          var restartIdleTimeout = function(text) {
			            if (idle_timeout)
			              window.clearTimeout(idle_timeout);
			            
			            idle_timeout = window.setTimeout(function() { doScope(text); }, IDLE_THRESHOLD);
			          };		
			          
					  $("#inputName").keyup(function() {
							var text = $('input[name=filter]').val();
							
						    if (text.length > MIN_TEXT_LENGTH) {
						        restartIdleTimeout(text);
						
						    	if (TRIGGER_CHARS.indexOf(text[text.length - 1]) > -1)
						        	doScope(text);
						    }
					  });
				  </script>
		          <div class="add-button" id="add-button">
				      <div id="addtargetform">
				        <form class="filter-form" action="@routes.LookUp.index()" method="GET">
				            <button type="submit" class="btn btn-success">Add new target</button>
				        </form>
				      </div>
		          </div>          
		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
				           <div class="panel-heading">
				               <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseCurator" style="color:#fff;">
				                   Filter by curator
				               </a>
				           </div>
				           <div id="collapseCurator" class="panel-collapse collapse">
				           @curators.map { curator =>	
				               @if(curatorUrl != null && !curatorUrl.equals("none")) {
						           <div class="panel-footer"><a class="brand" href="@routes.Targets.edit("none", organisationUrl, 
						               collectionCategoryUrl, subjectUrl, crawlFrequency, depth, scope, offset, limit)">
						            	   (-) </a> @curator.name &nbsp;(@curator.getTargetNumberByCuratorUrl())
						           </div>
							   } else {		                
					               @if(curator.url != null) {       
							           <div class="panel-footer"><a class="brand" href="@routes.Targets.edit(curator.url, organisationUrl, 
							               collectionCategoryUrl, subjectUrl, crawlFrequency, depth, scope, offset, limit)">
							               @curator.name &nbsp;(@curator.getTargetNumberByCuratorUrl())</a>
							           </div>
						           } 
						       }
			               }
		                   </div>
			          </div>
		          </div>
		          
		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
			            <div class="panel-heading">
			                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOrganisation" style="color:#fff;">
			            		Filter by nominating organisation
			            	</a>
			            </div>
					    <div id="collapseOrganisation" class="panel-collapse collapse">
			            @organisations.map { organisation =>	
			                @if(organisationUrl != null && !organisationUrl.equals("none")) {
					            <div class="panel-footer"><a class="brand" href="@routes.Targets.edit(curatorUrl, "none", 
					            	collectionCategoryUrl, subjectUrl, crawlFrequency, depth, scope, offset, limit)">
					            	(-) </a> @organisation.title &nbsp;(@organisation.getTargetNumberByOrganisationUrl())
					            </div>
							} else {		                
				            	@if(organisation.url != null) { 	              
						            <div class="panel-footer"><a class="brand" href="@routes.Targets.edit(curatorUrl, organisation.url, 
						            	collectionCategoryUrl, subjectUrl, crawlFrequency, depth, scope, offset, limit)">
						            	@organisation.title &nbsp;(@organisation.getTargetNumberByOrganisationUrl())</a>
						            </div>
				                }
			                }
			             }
				          </div>
			          </div>
		          </div>
		          
		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
			            <div class="panel-heading">
			            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseCollectionCategories" style="color:#fff;">
			            		Filter by collection categories
			            	</a>
			            </div>
					    <div id="collapseCollectionCategories" class="panel-collapse collapse">
				            @for(curCollectionCategory <- Taxonomy.findAll()) {
				            <div class="panel-footer">
				            	<a class="brand" href="@routes.Targets.edit(curatorUrl, organisationUrl, 
						            	curCollectionCategory.url, subjectUrl, crawlFrequency, depth, scope, offset, limit)">
						            	@curCollectionCategory.name &nbsp; (@Target.getTargetNumberByTaxonomyUrl(curCollectionCategory.url))</a>
				            </div>
				            }
				          </div>
			          </div>
		          </div>

		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
				            <div class="panel-heading">
				            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseSubjects" style="color:#fff;">
				            		Filter by subject
				            	</a>
				            </div>
							<div id="collapseSubjects" class="panel-collapse collapse">
				            @for(curSubject <- Targets.getSubjects()) {
				            <div class="panel-footer">
				            	<a class="brand" href="@routes.Targets.edit(curatorUrl, organisationUrl, 
						            	collectionCategoryUrl, curSubject.field_subject, crawlFrequency, depth, scope, offset, limit)">
						            	@curSubject.field_subject &nbsp; (@Target.getTargetNumberBySubjectUrl(curSubject.field_subject))</a>
				            </div>
				            }
				          </div>
			          </div>
		          </div>

		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
			            <div class="panel-heading">
			            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseCrawlFrequency" style="color:#fff;">
			            		Filter by crawl frequency
			            	</a>
			            </div>
						<div id="collapseCrawlFrequency" class="panel-collapse collapse">
				            @for(curCrawlFrequency <- Targets.getCrawlFrequency()) {
				            <div class="panel-footer">
				            	<a class="brand" href="@routes.Targets.edit(curatorUrl, organisationUrl, 
						            	collectionCategoryUrl, subjectUrl, curCrawlFrequency.field_crawl_frequency, depth, scope, offset, limit)">
						            	@curCrawlFrequency.field_crawl_frequency &nbsp; (@Target.getTargetNumberByCrawlFrequency(curCrawlFrequency.field_crawl_frequency))</a>
				            </div>
				            }
				          </div>
			          </div>
		          </div>
		          
		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
			            <div class="panel-heading">
			            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseDepth" style="color:#fff;">
			            		Filter by depth
			            	</a>
			            </div>
						<div id="collapseDepth" class="panel-collapse collapse">
				            @for(curDepth <- Targets.getDepth()) {
				            <div class="panel-footer">
				            	<a class="brand" href="@routes.Targets.edit(curatorUrl, organisationUrl, 
						            	collectionCategoryUrl, subjectUrl, crawlFrequency, curDepth.field_depth, scope, offset, limit)">
						            	@curDepth.field_depth &nbsp; (@Target.getTargetNumberByDepth(curDepth.field_depth))</a>
				            </div>
				            }
				          </div>
			          </div>
		          </div>
		          
		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
				            <div class="panel-heading">
				            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseLicense" style="color:#fff;">
				            		Filter by license
				            	</a>
				            </div>
							<div id="collapseLicense" class="panel-collapse collapse">
				            @for(curLicense <- Targets.getLicense()) {
				            <div class="panel-footer">
				            	<a class="brand" href="@routes.Targets.edit(curatorUrl, organisationUrl, 
						            	collectionCategoryUrl, subjectUrl, crawlFrequency, depth, scope, offset, limit)">
						            	@curLicense.name &nbsp; (@Target.getTargetNumberByLicense(curLicense.name))</a>
				            </div>
				            }
				          </div>
			          </div>
		          </div>
		          
		          <div class="panel-group" id="accordion">
			          <div class="panel panel-primary" id="panels">
				            <div class="panel-heading">
				            	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseScope" style="color:#fff;">
				            		Filter by scope
				            	</a>
				            </div>
							<div id="collapseScope" class="panel-collapse collapse">
					            @for(curScope <- Targets.getScope()) {
					            <div class="panel-footer">
				            	<a class="brand" href="@routes.Targets.edit(curatorUrl, organisationUrl, 
						            	collectionCategoryUrl, subjectUrl, crawlFrequency, depth, curScope.field_scope, offset, limit)">
						            	@curScope.field_scope &nbsp; (@Target.getTargetNumberByScope(curScope.field_scope))</a>
					            </div>
					            }
				          </div>
			          </div>
		          </div>
		        </div>
		        
		        <div class="col-lg-6">
		        	@pagination
					<!--script >
							$(function() {
							$("table#targetstable").tablesorter({ sortList: [[1,0]] });
							});
					</script>
					<table id="targetstable" class="tablesorter table table-striped table-bordered table-condensed zebra-striped"-->
					<table class="table table-striped table-bordered table-hover table-condensed">
		              <thead>
		                <tr>
		                  <!--<th>#</th>-->
		                  <th>Target name</th>
		                  <th>Target URL</th>
		                </tr>
		              </thead>
		              <tbody>
		              	@targets.map { target =>		              
		                <tr>
		                  <!--<td>@target.nid</td>-->
                  		  @if(target.url != null && target.title != null) {
		                  	<td><a href="@routes.TargetEdit.view(target.url)">
		                  		@target.title</a></td>
		                  } else {
		                    <td></td>
		                  }		                  
		                  <!--<td><a href="@target.url">@target.title</a></td>-->
		                  <td><a class="brand" href="@target.get_field_list_as_str("field_url")">@target.get_field_list_as_str("field_url")</a></td>
		                </tr>
		                }
		              </tbody>
		            </table>
		            @pagination
			     </div>
	          </div>
		</div>
    </article>
    
}

