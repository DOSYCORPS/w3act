@(target: Target, user: User)


@main("", user){
    
    <h1>Edit Target @target.title</h1>  
    <div class="targettabs">   
		<ul class="nav nav-tabs">
		   <li><a href="@routes.TargetEdit.view(target.url)" class="navbar-brand btn btn-success">View</a></li>
		   <li class="active"><a href="@routes.TargetEdit.edit(target.url)" class="navbar-brand btn btn-success">Edit</a></li> 
		</ul>
	</div>
    
    <article class="targetdetails">
      <div class="panel panel-default" id="forms">
       <div class="panel-heading">
        <!--h3 class="panel-title">Basic Information</h3-->
       </div>      
       <div class="panel-body">
        <form action="@routes.TargetController.saveTarget()" method="POST">
          <fieldset>
          	<!-- input type="hidden" name="nid" value="@target.nid"-->
          	<input type="hidden" name="user" value="@user.url">
            
			<div class="bs-example bs-example-tabs">
		      <ul id="myTab" class="nav nav-tabs">
		        <li class="active"><a href="#basicinformation" data-toggle="tab">Basic information</a></li>
		        <li class=""><a href="#metadata" data-toggle="tab">Metadata</a></li>
		        @if(Target.isInScope(target.field_url, target.url)) {
			        <li class=""><a href="#crawlpermission" data-toggle="tab">Crawl permission <font color="green">(+)</font></a></li>
			    } else {
			        <li class=""><a href="#crawlpermission" data-toggle="tab">Crawl permission <font color="red">(-)</font></a></li>
			    }		        
		        <li class=""><a href="#crawlpolicy" data-toggle="tab">Crawl policy</a></li>
		      </ul>
		       <div id="myTabContent" class="tab-content">
			        <div class="tab-pane fade active in" id="basicinformation">
			            <div class="form-group">
			              <label for="inputTitle">Title <font color="red">*</font></label>
			              <input class="form-control" name="title" id="inputTitle" size="60" placeholder="My title" type="text" value="@target.title">
				          <input class="form-control" name="nid" value="@target.nid" size="30" readonly>
			            </div>
			            <div class="form-group">
			              <label for="inputUrls">Seed URL(s) <font color="red">*</font></label>
					      @if(Target.isInScope(target.field_url, target.url) || 
					      		(target.field_url == null && Target.isInScope(target.title, target.url))) {
	                      	<label id="isInScope" style="color: green">is in scope</label>
	                      } else {
	                      	<label id="isInScope" style="color: red">is not in scope</label>
	                      }
			              @if(target.field_url != null) {
			              <input class="form-control" name="fieldurl" id="fieldurl" placeholder="url1, url2" type="text" value="@target.field_url">
			              } else {
			              <input class="form-control" name="fieldurl" id="fieldurl" placeholder="url1, url2" type="text" value="@target.title">
			              }
			              <p>One or more URLs, separated by comma.<p>
			              <!--button type="item" class="btn btn-success">Add another item</button-->
			            </div>
			            <script>
					          var idle_timeout,
					          SCOPE_URI = '/api/scope',
					          MIN_TEXT_LENGTH = 4, // minimum length annotation must have before being allowed to the doScope server
					          TRIGGER_CHARS = ". ,", // characters that force an doScope lookup
					          IDLE_THRESHOLD = 500; // doScope is also done after IDLE_THRESHOLD milliseconds of key idleness
				          
					          // Does the Scope lookup
					          var doScope = function(text) {
					              $.getJSON(SCOPE_URI + text, function(data) {
					              //alert("Is in scope: " + data);
					              var lab = document.getElementById('isInScope'); 
					              if (data) {
						              lab.innerHTML = "is in scope";
						              lab.style = "color: green";
					              } else {
						              lab.innerHTML = "is not in scope";
						              lab.style = "color: red";
					              }
					            });
					          };
					          
					          // Restarts the keyboard-idleness timeout
					          var restartIdleTimeout = function(text) {
					            if (idle_timeout)
					              window.clearTimeout(idle_timeout);
					            
					            idle_timeout = window.setTimeout(function() { doScope(text); }, IDLE_THRESHOLD);
					          };		
					          
							  $("#fieldurl").keyup(function() {
									var text = $('input[name=fieldurl]').val();
									
								    if (text.length > MIN_TEXT_LENGTH) {
								        restartIdleTimeout(text);
								
								    	if (TRIGGER_CHARS.indexOf(text[text.length - 1]) > -1)
								        	doScope(text);
								    }
							  });
						</script>			            
			            <div class="container">
						   <div class="row">
				                <label>QA Status</label><br>
						  		<label class="radio-inline">
						  		@if(target.status == 1) {
						          <input name="status" id="radio1" value="1" type="radio" checked="true">N/A
						        } else {
						          <input name="status" id="radio1" value="1" type="radio">N/A
						        }
						        </label>
						        <label class="radio-inline">
						  		@if(target.status == 2) {
						          <input name="status" id="radio2" value="2" type="radio" checked="true">No QA issues found
						        } else {
						          <input name="status" id="radio2" value="2" type="radio">No QA issues found
						        }
						        </label>
						        <label class="radio-inline">
						  		@if(target.status == 3) {
						          <input name="status" id="radio3" value="3" type="radio" checked="true">QA issue
						        } else {
						          <input name="status" id="radio3" value="3" type="radio">QA issue
						        }
						        </label>			      
						  	</div>
						</div>
			            <div class="container">
						   <div class="row">
				                <br><label>Live Site Status</label><br>
						  		<label class="radio-inline">
						  		@if(target.field_live_site_status != null && target.field_live_site_status.equals("N/A")) {
						          <input name="livesitestatus" id="radio1" value="N/A" type="radio" checked="true">N/A
						        } else {
						          <input name="livesitestatus" id="radio1" value="N/A" type="radio">N/A
						        }
						        </label>
						        <label class="radio-inline">
						  		@if(target.field_live_site_status != null && target.field_live_site_status.equals("Still live")) {
						          <input name="livesitestatus" id="radio2" value="Still live" type="radio" checked="true">Still live 
						        } else {
						          <input name="livesitestatus" id="radio2" value="Still live" type="radio">Still live 
						        }
						        </label>
						        <label class="radio-inline">
						  		@if(target.field_live_site_status != null && target.field_live_site_status.equals("No longer updated")) {
						          <input name="livesitestatus" id="radio3" value="No longer updated" type="radio" checked="true">No longer updated 
						        } else {
						          <input name="livesitestatus" id="radio3" value="No longer updated" type="radio">No longer updated 
						        }
						        </label>			      
						        <label class="radio-inline">
						  		@if(target.field_live_site_status != null && target.field_live_site_status.equals("Vanished")) {
						          <input name="livesitestatus" id="radio4" value="Vanished" type="radio" checked="true">Vanished
						        } else {
						          <input name="livesitestatus" id="radio4" value="Vanished" type="radio">Vanished
						        }
						        </label>			      
							  	<br>If know, please add the current status of the site.
						  	</div>
					  	</div><br>		
					  	<div class="form-group">
			                @if(target.field_key_site != null && target.field_key_site) {             
			                <input type="checkbox" name="keysite" value="true" checked/>
			                } else {
			                <input type="checkbox" name="keysite" value="true"/>
			                }
				 			<label class="option">Key Site</label>
			                <br>
			                Is this a 'key site', i.e. one of such significance that it requires higher levels of QA and archival management. 
			            </div>
			            <div class="form-group">
			              <label for="inputWCT">WCT ID</label>
			              <input name="wct" class="form-control" id="inputWCT" placeholder="0" type="text" readonly value="@target.field_wct_id">
			              <label for="inputSPT">SPT ID</label>
			              <input name="spt" class="form-control" id="inputSPT" placeholder="0" type="text" readonly value="@target.field_spt_id">
			            </div>
			            <div class="form-group"> 
		  				  <label>Keywords</label>
		 				  <input type="text" name="keywords" value="@target.keywords" size="60" maxlength="2048" class="form-text" />
						  <div class="description">The multiple uncontrolled keywords.</div>
						</div>
			            <div class="form-group"> 
		  				  <label>Synonyms</label>
		 				  <input type="text" name="synonyms" value="@target.synonyms" size="60" maxlength="2048" class="form-text" />
						  <div class="description">The synonyms support manual logging of identical content hosted on multiple domains.</div>
						</div>
			        </div>
			        <div class="tab-pane fade" id="metadata">
			            <div class="form-group">
				             <div class="container">
					              <label for="inputDescription">Description</label><br>
					              <textarea name="description" id="inputDescription" cols="100" rows="1" value="@target.field_description">@target.field_description</textarea>
					              <br>A description of this web site.
							</div>
				            <div class="container">
				                  <br><label>Subject</label><br>
								  <select name="subject" value="@target.field_subject">
						                <option>None</option>
						                @for(subject <- Taxonomy.findListByType("subject")) {
						             		@if(subject.name.equals(target.field_subject)) {
								                <option selected>@subject.name</option>
								            } else {						                
						                		<option>@subject.name</option>
						                	}
						                }
								  </select>
								  <br>
								  <h5>Special collections that you think this web site should appear in.</h5>				  
							</div>
				            <div class="container">
				                  <br><label>Suggested Collections</label><br>
								  <select name="field_suggested_collections">
						                <option>None</option>
						                @for(collection <- DCollection.findAll()) {
							                @if(collection.title.equals(DCollection.findByUrl(target.field_suggested_collections).title)) {
							                <option selected>@collection.title</option>
							                } else {
							                <option>@collection.title</option>
							                }
						                }
								  </select>
								  <br>
								  <h5>Special collections that you think this web site should appear in.</h5>				  
							</div>
				             <div class="container">
				                  <label>Nominating Organisation</label><br>
								  <select name="organisation" id="mySel">
						                <option>None</option>
						                @for(organisation <- Organisation.findAll()) {
							                @if(organisation.title.equals(Organisation.findByUrl(target.field_nominating_organisation).title) 
							                	|| organisation.title.equals(Organisation.findByUrl(user.field_affiliation).title)) {
								                <option selected>@organisation.title</option>
								            } else {
							                    <option>@organisation.title</option>
											}					            
						                }
								  </select>
								  <br>
								  <h5>The organisation that nominated this web site. Used to track down further information if the original user cannot be contacted.</h5>				  
							</div>
				             <div class="container">
				                  <label>User</label><br>
                  				  @if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
								  <select name="author" id="userSel">
								  } else {
								  <select name="author" id="userSel" disabled>
								  }
						                @for(selUser <- User.findAll()) {
							                @if((target.author != null && selUser.url.equals(target.author))
							                	|| (target.author == null && selUser.url.equals(user.url))) {
								                <option selected>@selUser.name</option>
								            } else {
							                    <option>@selUser.name</option>
											}					            
						                }
								  </select>
								  <br>
								  <h5>The user that nominated this web site. A record can be created on behalf of other user by high-level roles.</h5>				  
							</div>
			            </div>                        
			        </div>
			        <div class="tab-pane fade" id="crawlpermission">
			            <div class="form-group">
							<label for="edit-field-license-und">License</label>
			                <div>
							<select multiple="multiple" name="license" id="edit-field-license" class="form-select" size="2">
							 	<option value="_none">None</option>
							    @for(taxonomy <- Targets.getLicense()) {
					                @if(target.field_license != null && target.field_license.equals(taxonomy.name)) {             
								 	<option selected>@taxonomy.name</option>
								 	} else {
								 	<option>@taxonomy.name</option>
								 	}
							    }	
							</select>
							<button type="submit" class="btn btn-success">Open License Request</button>
							</div>
							<div class="description">The license terms under which this site should be archived and made available.</div>
							<label>Legal Deposit Criteria</label>
							<div class="fieldset-wrapper">
				                @if(target.field_uk_hosting != null && target.field_uk_hosting) {             
				                <input type="checkbox" name="field_uk_hosting" value="true" checked/>
				                } else {
				                <input type="checkbox" name="field_uk_hosting" value="true"/>
				                }
				 				<label class="option">UK Hosting</label>
				 			</div>
							<div class="description">The domain is hosted in the UK.</div>
							<div class="form-item form-type-checkbox form-item-field-uk-postal-address">
				                @if(target.field_uk_postal_address != null && target.field_uk_postal_address) {             
				                <input type="checkbox" name="field_uk_postal_address" value="true" checked/>
				                } else {
				                <input type="checkbox" name="field_uk_postal_address" value="true"/>
				                }
					 			<label class="option">UK Postal Address</label>
				 			</div>
							<div class="description">The 'about us' or other contact page contains a UK address for a significant part of the organisation (e.g. it is not just a PO box).</div>
							<div>
				  				<label for="edit-field-uk-postal-address-url-und-0">Postal Address URL </label>
				 				<div>
				  				<label class="element-invisible" for="edit-field-uk-postal-address-url-und-0-url">URL </label>
				 				<input type="text" name="field_uk_postal_address_url" value="@target.field_uk_postal_address_url" size="60" maxlength="2048" class="form-text" />
								</div>
								<div class="description">The URL on the site that contains the postal address used to determine that the site is in the UK.</div>
							</div>
							<div>
				                @if(target.field_via_correspondence != null && target.field_via_correspondence) {             
				                <input type="checkbox" name="field_via_correspondence" value="true" checked/>
				                } else {
				                <input type="checkbox" name="field_via_correspondence" value="true"/>
				                }
					 			<label class="option">Via Correspondence</label>
								<div class="description">Previous correspondence with the web site owner by a Curator contains evidence of a UK address.</div>
							</div>
							<div>
				  				<label>Notes</label>
					 			<div class="form-textarea-wrapper resizable">
					 				<textarea name="field_notes" cols="100" rows="1">@target.field_notes</textarea>
								</div>
								<div class="description">Any relevant notes, e.g. a more detailed description of this URL or set of URLs.</div>
							</div>
							<div>
				                @if(target.field_professional_judgement != null && target.field_professional_judgement) {             
				                <input type="checkbox" name="field_professional_judgement" value="true" checked/>
				                } else {
				                <input type="checkbox" name="field_professional_judgement" value="true"/>
				                }
					 			<label class="option">Professional Judgement</label>
								<div class="description">In your professional judgement, does this site qualify as a UK Publication under the terms of the Legal Deposit Legislation. Please provide details of evidence used in the box below.</div>
							</div>
							<div>
				  				<label>Professional Judgement Explanation</label>
				 				<div class="form-textarea-wrapper resizable">
				 					<textarea name="field_professional_judgement_exp" cols="100" rows="1">@target.field_professional_judgement_exp</textarea>
				 				</div>
								<div class="description">Please describe the rational behind this decision, indicating any evidence used.</div>
							</div>
							<div>
				                @if(target.field_no_ld_criteria_met != null && target.field_no_ld_criteria_met) {             
				                <input type="checkbox" name="field_no_ld_criteria_met" value="true" checked/>
				                } else {
				                <input type="checkbox" name="field_no_ld_criteria_met" value="true"/>
				                }
					 			<label class="option">No LD Criteria Met</label>
								<div class="description">Use this to indicate that no LD criteria apply, and so this site cannot be archived under Legal Deposit.</div>
							</div>      			            
				        </div>
			        </div>
			        <div class="tab-pane fade" id="crawlpolicy">
			            <div class="form-group">
					         <div class="container">
					         	<div class="row">
								  <label>Scope<font color="red">*</font></label><br>										  
								  <select name="field_scope">
					             		@if(target.field_scope.equals("Just this URL.")) {
						                <option selected>Just this URL.</option>
							            } else {						                
						                <option>Just this URL.</option>
						                }
					             		@if(target.field_scope.equals("This URL plus any directly linked resources.")) {
						                <option selected>This URL plus any directly linked resources.</option>
							            } else {						                
						                <option>This URL plus any directly linked resources.</option>
						                }
					             		@if(target.field_scope.equals("All URLs that start like this.")) {
						                <option selected>All URLs that start like this.</option>
							            } else {						                
						                <option>All URLs that start like this.</option>
						                }
					             		@if(target.field_scope.equals("All URLs that match match this host or any subdomains.")) {
						                <option selected>All URLs that match match this host or any subdomains.</option>
							            } else {						                
						                <option>All URLs that match match this host or any subdomains.</option>
						                }
								  </select>
								  <br>
								  <h5>Select the scope of the crawl around this URL. In general, when nominating a site for crawling, you should specify the homepage and say 'All URLs that start like this'. If you wish to include all subdomains (e.g. example.co.uk but also anything like www.example.co.uk, images.example.co.uk, etc.) then select the 'any subdomains' option.</h5>				  
							  	</div>
							  </div>
				              <div class="container">
								<div class="row">
								    <label>Depth<font color="red">*</font></label><br>	
							  		<label class="radio-inline">
							  		  @if(target.field_depth != null && target.field_depth.equals("Capped (small - 500MB)")) {
							          <input name="field_depth" id="radio1" value="Capped (small - 500MB)" type="radio" checked>Capped (small - 500MB)
							          } else { 
							          <input name="field_depth" id="radio1" value="Capped (small - 500MB)" type="radio">Capped (small - 500MB) 
							          }
							        </label>
							        <label class="radio-inline">
							  		  @if(target.field_depth != null && target.field_depth.equals("Capped (large - 2GB)")) {
							          <input name="field_depth" id="radio2" value="Capped (large - 2GB)" type="radio" checked>Capped (large - 2GB)
							          } else {
							          <input name="field_depth" id="radio2" value="Capped (large - 2GB)" type="radio">Capped (large - 2GB)
							          }
							        </label>
							        <label class="radio-inline">
							  		  @if(target.field_depth != null && target.field_depth.equals("Uncapped")) {
							          <input name="field_depth" id="radio3" value="Uncapped" type="radio" checked>Uncapped
							          } else {
							          <input name="field_depth" id="radio3" value="Uncapped" type="radio">Uncapped
							          }
							        </label>			      
							  	</div>
							  </div>
							  <br>
					            <div class="form-group">
					                @if(target.field_ignore_robots_txt != null && target.field_ignore_robots_txt) {             
					                <input type="checkbox" name="field_ignore_robots_txt" value="true" checked/>
					                } else {
					                <input type="checkbox" name="field_ignore_robots_txt" value="true"/>
					                }
						 			<label class="option">Ignore Robots.txt</label>
						            <br>Should we ignore Robots.txt while crawling this site? Note that although this may lead to us exploring more crawler traps, this does not present much of a problem to our crawling systems.</p>
					            </div>
				 				<label for="edit-field-crawl-frequency-und">Crawl Frequency<span class="form-required" title="This field is required."><font color="red">*</font></span></label><br>
				 				<select id="edit-field-crawl-frequency-und" name="field_crawl_frequency" class="form-select required">
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Domain Crawl Only")) {
				 					<option selected>Domain Crawl Only</option>
						            } else {						                
				 					<option>Domain Crawl Only</option>
					                }
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Annually")) {
				 					<option selected>Annually</option>
						            } else {						                
				 					<option>Annually</option>
					                }
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Six-monthly")) {
				 					<option selected>Six-monthly</option>
						            } else {						                
				 					<option>Six-monthly</option>
					                }
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Quarterly")) {
				 					<option selected>Quarterly</option>
						            } else {						                
				 					<option>Quarterly</option>
					                }
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Monthly")) {
				 					<option selected>Monthly</option>
						            } else {						                
				 					<option>Monthly</option>
					                }
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Old-Monthly-DO-NOT-USE")) {
				 					<option selected>Old-Monthly-DO-NOT-USE</option>
						            } else {						                
				 					<option>Old-Monthly-DO-NOT-USE</option>
					                }
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Weekly")) {
				 					<option selected>Weekly</option>
						            } else {						                
				 					<option>Weekly</option>
					                }
				             		@if(target.field_crawl_frequency != null && target.field_crawl_frequency.equals("Daily")) {
				 					<option selected>Daily</option>
						            } else {						                
				 					<option>Daily</option>
					                }
				 				</select>
								<div class="description">How often should this site be archived?</div>
					        </div>    
				              <div class="container">
				 				<div class="row">
				  					<label class="element-invisible">Start date</label>
				 					<input type="text" name="field_crawl_start_date" value="@target.field_crawl_start_date" size="30" maxlength="2048" class="form-text" />
				  					<label class="element-invisible">End date</label>
				 					<input type="text" name="field_crawl_end_date" value="@target.field_crawl_end_date" size="30" maxlength="2048" class="form-text" />
								</div>
							  </div>
				              <div class="container">
				 				<div class="row">
				  					<label class="element-invisible">White list</label>
				 					<input type="text" name="white_list" value="@target.white_list" size="30" maxlength="2048" class="form-text" />
				  					<label class="element-invisible">Black list</label>
				 					<input type="text" name="black_list" value="@target.black_list" size="30" maxlength="2048" class="form-text" />
								</div>
							  </div>
				        </div>
			        </div>
            </div>
	        <div id="revisionArea" class="revision">
  				<div class="form-group">
  			       <hr>
	               <label for="inputBody">Revision log message</label>
	               <textarea class="text-full form-textarea" name="revision" id="inputRevision" cols="100" rows="1"></textarea>
        		   <br>Provide an explanation of the changes you are making. This will help other authors understand your motivations. 
				</div>
			</div>
	        
            <button type="save" class="btn btn-primary" id="edit-save" name="save">Save</button>
            <!--button type="preview" class="btn btn-primary" name="preview">Preview</button-->
            <button type="delete" class="btn btn-primary" name="delete">Delete</button>
          </fieldset>
        </form>
       </div>
      </div>
    </article>
    
    
}

