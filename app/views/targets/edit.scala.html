@(form: Form[Target], user: User, collectionData :com.fasterxml.jackson.databind.JsonNode, subjectData :com.fasterxml.jackson.databind.JsonNode, authors: List[User], tags: List[Tag], flags: List[Flag], qaIssues: List[QaIssue], languages: Array[uk.bl.Const.TargetLanguage], selectionTypes: Array[uk.bl.Const.SelectionType], scopeTypes: Array[uk.bl.Const.ScopeType], depthTypes: Array[uk.bl.Const.DepthType], licenses: List[License], crawlPermissionStatuses: Array[uk.bl.Const.CrawlPermissionStatus], crawlFrequencies: Array[uk.bl.Const.CrawlFrequency], siteStatuses: Array[uk.bl.Const.SiteStatus])

@getJson(data: com.fasterxml.jackson.databind.JsonNode) = @{
	Html(data.toString)
}

@scripts = {
	<script>
		// This is the code that switches to the other page.
		// We do this via JavaScript, and not a normal hyperlink,
		// because that way we can communicate the current nav pill status as part of the link URL.
		function switchPage() {
	        var activeTab = $('#myNavbar li.active'); // Here we grab the li that's currently marked as 'active'
	        var href = activeTab.find('a').attr('href'); // here we grab the href of the link inside the active tab
	
	  		// pass the current tab to the save method in order to load page in the same tab
	  		document.getElementById('tabstatus').value = activeTab.find('a').attr('href');
	        //alert(document.getElementById('tabstatus').value);
	
	        // And finally we just attach the href to view.html and forward the browser. 
	        // An example URL would be: 'view.html#npld-scope'
	        window.location.href="@routes.TargetController.view(form.get.id)" + href;
		}
	
		(function() {
	        var idle_timeout,
	        SCOPE_URI = '/api/scope',
	        MIN_TEXT_LENGTH = 4, // minimum length annotation must have before being allowed to the doScope server
	        TRIGGER_CHARS = ". ,", // characters that force an doScope lookup
	        IDLE_THRESHOLD = 500; // doScope is also done after IDLE_THRESHOLD milliseconds of key idleness
	  
	        // Does the Scope lookup
	        var doScope = function(text) {
	            $.getJSON(SCOPE_URI + text, function(data) {
	            //alert("Is in scope: " + data);
	            var lab = document.querySelector('isInScope'); 
	            if (data) {
		              lab.innerHTML = "is in scope";
		              lab.style = "color: green";
	            } else {
		              lab.innerHTML = "is not in scope";
		              lab.style = "color: red";
	            }
	          });
	        };
		})();	
	
		$(document).ready(function() {
		          
			// Restarts the keyboard-idleness timeout
			var restartIdleTimeout = function(text) {
				if (idle_timeout) {
				    window.clearTimeout(idle_timeout);
				}
				
				idle_timeout = window.setTimeout(function() { doScope(text); }, IDLE_THRESHOLD);
			};		
      
			$("#fieldUrls").keyup(function() {
				var text = $('input[name=fieldUrls]').val();
	
				if (text.length > MIN_TEXT_LENGTH) {
					restartIdleTimeout(text);
					if (TRIGGER_CHARS.indexOf(text[text.length - 1]) > -1) {
				       	doScope(text);
					}
				}
			});
			  
			showTree(@getJson(collectionData), "#collectionTree", "collectionSelect");
			showTree(@getJson(subjectData), "#subjectTree", "subjectSelect");
            
			function showTree(data, id, key) {
	        	//console.log(data);
	         	$(id).dynatree({
					checkbox: true,
	            	selectMode: 2,
	            	children: data,
	            	onSelect: function(select, node) {
	              		// Get a list of all selected nodes, and convert to a key array:
	              		var selKeys = $.map(node.tree.getSelectedNodes(), function(node){
	                		return node.data.key;
	              		});
	              		document.getElementById(key).value = selKeys.join(", ");
	              		
	              		console.log("test: " + document.getElementById(key).value);
	              		// Get a list of all selected TOP nodes
	              		var selRootNodes = node.tree.getSelectedNodes(true);
	              		// ... and convert to a key array:
	              		var selRootKeys = $.map(selRootNodes, function(node){
	                		return node.data.key;
	              		});
	            	}
	         	});
	        }
       
			// This happens right after the document is loaded.
			// Our nav pills won't do anything by themselves, so we need to make sure we
			// check if the current URL has a #-component and if so, we activate the
			// appropriate pill.
	        var hash = window.location.hash;
	        if (hash.indexOf('#') == 0) {
				// We have a hash - let's see if it matches with nav pill href
				var el = $('#myNavbar a[href=' + hash + ']');
        
				// pass the current tab to the save method in order to load page in the same tab
				document.getElementById('tabstatus').value = hash;
				//alert(document.getElementById('tabstatus').value);

				// We have an <a> with this ID, and it has a parent node that's an <li>
				if (el && el.parent() && el.parent().prop('tagName') == 'LI') {
					// So we activate this nav pill
					$(el).tab('show');
					window.scrollTo(0, 0);
				}
			} else {
	        	//console.log('tabstatus after validation: ' + document.getElementById('tabstatus').value);
	        	var valtab = document.getElementById('tabstatus').value;
	            if (valtab.indexOf('#') == 0) {
	                // We have a hash - let's see if it matches with nav pill href
	                var valel = $('#myNavbar a[href=' + valtab + ']');
	              
	          	    // We have an <a> with this ID, and it has a parent node that's an <li>
	                if (valel && valel.parent() && valel.parent().prop('tagName') == 'LI') {
	                  // So we activate this nav pill
	                  $(valel).tab('show');
	                  window.scrollTo(0, 0);
	                }
	            } 
			}
        
			// This is completely optional!! But it keeps the hash in our current URL bar
			// in sync with the tab we have selected, so the pages stay nice and bookmarkable
			$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
				window.location.hash = ($(e.target).attr('href'));
				document.getElementById('tabstatus').value = ($(e.target).attr('href'));
				//alert(document.getElementById('tabstatus').value);
				window.scrollTo(0, 0);
			})
		});		
	</script>
}

@styles = {
    <style>
	    #tab-content {
	      padding:20px;
	    }
	    
	    .tab-pane {
	      padding:20px 0;
	    }
    </style>
}

@main("", user, scripts, styles) {
    
   	<div class="page-header">
	    <h1><a href="@routes.TargetController.index()">Targets > </a>Target @form.get.title</h1>
	</div>  
	
	<ul class="nav nav-tabs">
	   @if(form.get != null) {
		   <li><a onclick="switchPage(); return false;" href="@routes.TargetController.view(form.get.id)">View</a></li>
	   }
	   @if(((user.hasRole("sys_admin") || user.hasRole("archivist") || user.hasRole("expert_user"))) 
	   		|| (user.hasRole("user") && user.id == form.get.authorUser.id)) {
		   <li class="active"><a href="#">Edit</a></li> 
	   }
	</ul>
      
	<div class="tab-content padding-20">
	           
		<ul class="nav nav-pills" id="myNavbar">
	        <li class="active"><a href="#overview" data-toggle="tab">Overview</a></li>
	        <li><a href="#metadata" data-toggle="tab">Metadata</a></li>
		    <li><a href="#crawlpolicy" data-toggle="tab">Crawl policy and Schedule</a></li>
			<li>
				<a href="#crawlpermission" data-toggle="tab">NPLD scope 
				@if(form.get.isInScopeAllWithoutLicense) {
					<font color="green">(+)</font>
				} else {
					<font color="red">(-)</font>
				}		        
				</a>
			</li>
		    <li><a href="#licensing" data-toggle="tab">UKWA Licensing
		    	@if(form.get.hasGrantedLicense) {
					<font color="green">(+)</font>
				} else {
					<font color="red">(-)</font>
				}		        
		    </a></li>
	  	</ul>
	</div>
	
	@warningmessage(flash)
	@helper.form(action=routes.TargetController.save) {
	
	<input type="hidden" name="id" value="@form.get.id">
	<input type="hidden" name="url" value="@form.get.url">
	<input type="hidden" name="user_id" value="@user.id">	
	<input type="hidden" id="tabstatus" name="tabstatus" value="@form.get.tabStatus">

	@if(user.hasRole("sys_admin") || user.hasRole("archivist") || user.hasRole("expert_user") || user.hasRole("user")) {     			     		
		<div class="row padding-10 pull-right">
     		<div class="col-md-12 col-xs-12 col-sm-12">
				<div class="btn-group">
				    @if(form.get.authorUser != null && user.hasRole("user") 
				    	&& !user.hasRole("expert_user") 
				    	&& !user.hasRole("archivist") 
				    	&& !user.hasRole("sys_admin") 
				    	&& user.id != form.get.authorUser.id) { 
					<button type="submit" class="btn btn-primary" name="save" id="edit-save" disabled>Save</button>
				       @if(form.get != null) {
					<button type="submit" class="btn btn-primary" name="delete" onclick="return confirm('Are you sure?');" id="delete" disabled>Delete</button>
					   }
					} else {
					<button type="submit" class="btn btn-primary" name="save" id="edit-save">Save</button>
				       @if(form.get != null) {
					<button type="submit" class="btn btn-primary" name="delete" onclick="return confirm('Are you sure?');" id="delete">Delete</button>
					   }
					}
		       </div>
			</div>
		</div>
		}

		<div id="myTabContent" class="tab-content">
			<div class="tab-pane padding-20 fade active in" id="overview">
				<input type="hidden" name="user" value="@user.url">
	   
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputTitle" class="col-sm-6 control-label">Title <font color="red">*</font></label>
						    <div class="col-sm-6">
				              <input class="form-control" name="title" id="inputTitle" size="60" placeholder="Title" type="text" value="@form.get.title">
							</div>
						</div>
					</div>
		     	</div>

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">ID <font color="red">*</font></label>
						    <div class="col-sm-6">
								<input class="form-control" name="id" value="@form.get.id" size="30" readonly>
							</div>
						</div>
					</div>
		     	</div>

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								Seed URL(s) <font color="red">*</font>
								<small class="text-center">(One or more URLs, separated by comma)</small>
							</label>
						    <div class="col-sm-6">
								<input class="form-control" name="fieldUrls" id="fieldUrls" placeholder="url1, url2" type="text" value="@form.get.formUrl">
							</div>
						</div>
					</div>
		     	</div>	 
		     	    	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								UK Hosting
							</label>
						    <div class="col-sm-6">
								@if(form.get.isUkHosting) {
					            	<font id="isInScope" style="color: green">yes</font>
								} else {
									<font id="isInScope" style="color: red">no</font>
								}
							</div>
						</div>
					</div>
		     	</div>	     	
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								UK top-level domain <small class="text-center">(Includes .uk, .london and .scot domains)</small>
							</label>
						    <div class="col-sm-6">
								@if(form.get.isTopLevelDomain) {
					            	<font id="isInScope" style="color: green">yes</font>
								} else {
									<font id="isInScope" style="color: red">no</font>
								}
							</div>
						</div>
					</div>
		     	</div>	     	
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								UK Registration
							</label>
						    <div class="col-sm-6">
								@if(form.get.isUkRegistration()) {
					            	<font id="isInScope" style="color: green">yes</font>
								} else {
									<font id="isInScope" style="color: red">no</font>
								}
							</div>
						</div>
					</div>
		     	</div>	     	
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="qaIssueId" class="col-sm-6 control-label">QA Status</label>
						    <div class="col-sm-6">
								<select name="qaIssueId" id="qaIssueId" class="form-control">
									@for(qaIssue <- qaIssues) {
						                @if(form.get.qaIssue != null && form.get.qaIssue.id == qaIssue.id) {             
									 		<option value="@qaIssue.id" selected>@qaIssue.name</option>
									 	} else {
										 	<option value="@qaIssue.id">@qaIssue.name</option>
									 	}									 	
								    }
                                </select>
							</div>
						</div>
					</div>
		     	</div>	     
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Live Site Status <small class="text-center">(If known, please add the current status of the site)</small></label>
						    <div class="col-sm-6">
						    	@for(siteStatus <- siteStatuses) {
									<label class="radio-inline">
								  		@if(form.get.liveSiteStatus != null && form.get.liveSiteStatus.equals(siteStatus.name)) {
								        	<input name="livesitestatus" value="@siteStatus.name()" type="radio" checked="checked"> @siteStatus.getValue()
								        } else {
								        	<input name="livesitestatus" value="@siteStatus.name()" type="radio"> @siteStatus.getValue()
								        }
									</label>
								}
							</div>
						</div>
					</div>
		     	</div>	     
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Key Site <small class="text-center">(Is this a 'key site', i.e. one of such significance that it requires higher levels of QA and archival management)</small></label>
						    <div class="col-sm-6">
				                @if(form.get.keySite != null && form.get.keySite) {             
					                <input type="checkbox" name="keysite" value="true" checked />
				                } else {
					                <input type="checkbox" name="keysite" value="true"/>
				                }
							</div>
						</div>
					</div>
		     	</div>	     
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputWCT" class="col-sm-6 control-label">WCT ID</label>
						    <div class="col-sm-6">
	   						@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {						    
			              		<input name="wct" class="form-control" id="inputWCT" placeholder="0" type="text" value="@form.get.wctId">
			              	} else {
			              		<input name="wct" class="form-control" id="inputWCT" placeholder="0" type="text" readonly value="@form.get.wctId">
			              	}
							</div>
						</div>
					</div>
		     	</div>
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="inputSPT" class="col-sm-6 control-label">SPT ID</label>
						    <div class="col-sm-6">
	   						@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {						    
			              		<input name="spt" class="form-control" id="inputSPT" placeholder="0" type="text" value="@form.get.sptId".value">
			              	} else {
			              		<input name="spt" class="form-control" id="inputSPT" placeholder="0" type="text" readonly value="@form.get.sptId">
			                }
							</div>
						</div>
					</div>
		     	</div>
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="keywords" class="col-sm-6 control-label">Keyword(s) <small class="text-center">(The multiple private uncontrolled keywords)</small></label>
						    <div class="col-sm-6">
		 				  		<input id="keywords" type="text" name="keywords" value="@form.get.keywords" size="60" maxlength="2048" class="form-control" />
							</div>
						</div>
					</div>
		     	</div>
	
		   		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="tags" class="col-sm-6 control-label">Tag(s) <small class="text-center">(The multiple open keywords)</small></label>
						    <div class="col-sm-6">
								<select multiple name="tagList" id="tags" class="form-control">
					                @for(tag <- tags) {
										@if(form.get.tags.contains(tag)) {
						                	<option value="@tag.id" selected>@tag.name</option>
						                } else {
						                	<option value="@tag.id">@tag.name</option>
						                }
					                }
								</select>
							</div>
						</div>
					</div>
		     	</div>		   

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="Synonyms" class="col-sm-6 control-label">Synonyms <small class="text-center">(The synonyms support manual logging of identical content hosted on multiple domains)</small></label>
						    <div class="col-sm-6">
		 				  		<input type="text" name="synonyms" value="@form.get.synonyms" size="60" maxlength="2048" class="form-control" />
							</div>
						</div>
					</div>
		     	</div>
			</div>
			
		    <div class="tab-pane fade" id="metadata">
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="inputDescription" class="col-sm-6 control-label">Description <small class="text-center">(A description of this web site)</small></label>
						    <div class="col-sm-6">
				            	<textarea class="form-control" name="description" id="inputDescription" cols="100" rows="1" value="@form.get.description">@form.get.description</textarea>
							</div>
						</div>
					</div>
		     	</div>		    
		    
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="subjects" class="col-sm-6 control-label">Subject <font color="red">*</font> <small class="text-center">(Please select at least one subject. To select more than one, hold down the CTRL key.)</small></label>
						    <div class="col-sm-6">
			    			  @if(user.hasRole("sys_admin") || user.hasRole("archivist") || user.hasRole("expert_user") || (form.get.authorUser != null && user.id == form.get.authorUser.id)) {
								  <div id="subjectTree"></div>
								  <input type="hidden" id="subjectSelect" name="subjectSelect" value="@form.get.subjectIdsAsString()">
							  } else {
							        @if(form.get.subjects != null || !form.get.subjects.isEmpty()) {
	  									@form.get.subjectsAsString()
	  								} else {
	  								    none
	  								}
		     	              }	   
							</div>
						</div>
					</div>
		     	</div>	   
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="suggestions-collections" class="col-sm-6 control-label">Collections <small class="text-center">(Special collections that you think this web site should appear in)</small></label>
						    <div class="col-sm-6">
			    				@if(user.hasRole("sys_admin") || user.hasRole("archivist") || user.hasRole("expert_user")) {
							  		<div id="collectionTree"></div>
							  		<input type="hidden" id="collectionSelect" name="collectionSelect" value="@form.get.collectionIdsAsString()">
							  	} else {
							        @if(form.get.collections == null || !form.get.collections.isEmpty()) {
							        	@form.get.collectionsAsString()
	  								} else {
	  								    none
	  								}
		     	              }	   
							</div>
						</div>
					</div>
		     	</div>	   
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="mySel" class="col-sm-6 control-label">Nominating Organisation <small class="text-center">(The organisation that nominated this web site. Used to track down further information if the original user cannot be contacted)</small></label>
						    <div class="col-sm-6">
								<select name="organisationId" id="organisationId" class="form-control">
					            	<option value="-1">None</option>
					                @for(organisation <- Organisation.findAll()) {
						                @if(form.get.organisation != null && organisation.id == form.get.organisation.id) {
							                <option value="@organisation.id" selected>@organisation.title</option>
							            } else {
						                    <option value="@organisation.id">@organisation.title</option>
										}					            
					                }
								</select>
							</div>
						</div>
					</div>
		     	</div>		   

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="originating_organisation" class="col-sm-6 control-label">Originating Organisation <small class="text-center">(the organisation(s) responsible for creating the content)</small></label>
						    <div class="col-sm-6">
				            	<textarea class="form-control" name="originatingOrganisation" id="originating_organisation" cols="100" rows="1" value="@form.get.originatingOrganisation">@form.get.originatingOrganisation</textarea>
							</div>
						</div>
					</div>
		     	</div>		    		    
     			     		
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="authorUser" class="col-sm-6 control-label">Selector <font color="red">*</font> <small class="text-center">(The user that nominated this web site. A record can be created on behalf of other user by high-level roles)</small></label>
						    <div class="col-sm-6">
								@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
							  		<select name="authorId" id="userSel" class="form-control">
							  	} else {
							  		<select name="authorId" id="userSel" disabled class="form-control">
							  	}
					            @for(author <- authors) {
						        	@if((form.get.authorUser != null && author.id == form.get.authorUser.id) || (form.get.authorUser == null && author.id == user.id)) {
							            <option value="@author.id" selected>@author.name</option>
									} else {
						            	<option value="@author.id">@author.name</option>
									}
								}
								</select>
							</div>
						</div>
					</div>
		     	</div>	
		     	
		     	<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="language" class="col-sm-6 control-label">Language <small class="text-center">(The predominant language in which the page is written)</small></label>
						    <div class="col-sm-6">
								<select name="language" id="language" class="form-control">
					                @for(language <- languages) {
						                @if(form.get.language != null && form.get.language.equals(language.name)) {
						                	<option value="@language.name" selected>@language.getValue</option>
						                } else {
						                	<option value="@language.name">@language.getValue</option>
						                }
					                }
								</select>
							</div>
						</div>
					</div>
		     	</div>		   
		     	
				@if(user.hasRole("sys_admin") || user.hasRole("archivist") || user.hasRole("expert_user") || user.hasRole("user")) {     			     		
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="authors" class="col-sm-6 control-label">Author(s) <small class="text-center">(A named individual responsible for creating the content)</small></label>
						    <div class="col-sm-6">
						    <div class="col-sm-6">
				            	<textarea class="form-control" name="authors" id="authors" cols="100" rows="1" value="@form.get.authors">@form.get.authors</textarea>
							</div>
							</div>
						</div>
					</div>
		     	</div>		    		    
     			     		
		   		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Flag(s) <small class="text-center">(Allows users to flag record for attention, using a pre-defined list of flag names)</small></label>
						    <div class="col-sm-6">
						        @for((flag, index) <- flags.zipWithIndex) {
									<label class="checkbox-inline">
						                @if(form.get.flags.contains(flag)) {
						                	<input type="checkbox" name="flagList" value="@flag.id" checked />
						                } else {
						                	<input type="checkbox" name="flagList" value="@flag.id" />
						                }
						                @flag.name
					                </label>
					            }
							</div>
						</div>
					</div>
		     	</div>	     		

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="inputFlagNotes" class="col-sm-6 control-label">Flag notes <small class="text-center">(More details about the flagged issue)</small></label>
						    <div class="col-sm-6">
				            	<textarea class="form-control" name="flagNotes" id="flagNotes" cols="100" rows="1" value="@form.get.flagNotes">@form.get.flagNotes</textarea>
							</div>
						</div>
					</div>
		     	</div>		    		    
		     	}	   

				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Date of publication</label>
						    <div class="col-sm-6">
		 						<input type="text" name="date_of_publication" value="@form.get.dateOfPublication" size="30" maxlength="2048" class="form-control" id="date_of_publication"/>
	                		</div>
						</div>
					</div>
		     	</div>	

				@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Justification <small class="text-center">(This field should include any information provided by curators justifying the creation of the record. This field is NOT public.)</small></label>
						    <div class="col-sm-6">
				            	<textarea class="form-control" name="justification" id="inputJustification" cols="100" rows="1" value="@form.get.justification">@form.get.justification</textarea>
							</div>
						</div>
					</div>
		     	</div>	
		     	}	     			     

		     	<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
			              	<label for="selection_type" class="col-sm-6 control-label">Selection Type <font color="red">*</font> <small class="text-center">(This records if the selection was a Nomination (e.g. via UKWA website or other means) or a Selection (via an ACT User))</small></label>
						    <div class="col-sm-6">
								<select name="selectionType" id="selectionType" class="form-control">
					                @for(selectionType <- selectionTypes) {
						                @if(form.get.selectionType != null && form.get.selectionType.equals(selectionType.name)) {
						                	<option value="@selectionType.name" selected>@selectionType.getValue</option>
						                } else {
						                	<option value="@selectionType.name">@selectionType.getValue</option>
						                }
					                }
								</select>
							</div>
						</div>
					</div>
		     	</div>		   
		     			     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Selector Notes <small class="text-center">(This field allows further notes to selection for WA team, not captured in Justification field.)</small></label>
						    <div class="col-sm-6">
				            	<textarea class="form-control" name="selector_notes" id="input_selector_notes" cols="100" rows="1" value="@form.get.selectorNotes">@form.get.selectorNotes</textarea>
							</div>
						</div>
					</div>
		     	</div>	
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="legacy_cite_id" class="col-sm-6 control-label">Legacy site ID <small class="text-center">(ID used to identify paper licences.)</small></label>
						    <div class="col-sm-6">
			              		<input name="legacy_site_id" class="form-control" id="legacy_site_id" placeholder="0" type="text" value="@form.get.legacySiteId">
							</div>
						</div>
					</div>
		     	</div>
		     	
			</div>
			
			<div class="tab-pane fade" id="crawlpermission">
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Legal Deposit Criteria</label>
						</div>
					</div>
		     	</div>
				<div class="padding-20">
					<div class="alert alert-info">
						In order to be considered as in scope for Non-Print Legal Deposit, a resource must pass one of a series of tests.
					</div>
				</div>		
				
				@if(form.get.indicateNpldStatus()) {    	
					<div class="padding-20">
						<div class="alert alert-info">
							NB. There are other records within this domain for which data has already been provided.
							@for(targetObj <- form.get.getNpldStatusList()) {
								<p><a href="@routes.TargetController.viewAct(targetObj.url)">@targetObj.title @targetObj.fieldUrl</a></p>
							}
						</div>
					</div>	
				}	     	

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								UK Hosting
							</label>
						    <div class="col-sm-6">
								@if(form.get.isUkHosting) {
					            	<font id="isInScope" style="color: green">yes</font>
								} else {
									<font id="isInScope" style="color: red">no</font>
								}
							</div>
						</div>
					</div>
		     	</div>	     	
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								UK top-level domain <small class="text-center">(Includes .uk, .london and .scot domains)</small>
							</label>
						    <div class="col-sm-6">
								@if(form.get.isTopLevelDomain) {
					            	<font id="isInScope" style="color: green">yes</font>
								} else {
									<font id="isInScope" style="color: red">no</font>
								}
							</div>
						</div>
					</div>
		     	</div>	     	
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								UK Registration
							</label>
						    <div class="col-sm-6">
								@if(form.get.isUkRegistration) {
					            	<font id="isInScope" style="color: green">yes</font>
								} else {
									<font id="isInScope" style="color: red">no</font>
								}
							</div>
						</div>
					</div>
		     	</div>	     	
	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">UK Postal Address <small class="text-center">(The 'about us' or other contact page contains a UK address for a significant part of the organisation (e.g. it is not just a PO box))</small></label>
						    <div class="col-sm-6">
				                @if(form.get.ukPostalAddress != null && form.get.ukPostalAddress) {             
					                <input type="checkbox" name="field_uk_postal_address" value="true" checked/>
				                } else {
					                <input type="checkbox" name="field_uk_postal_address" value="true" />
				                }
							</div>
						</div>
					</div>
		     	</div>		     				     	

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Postal Address URL <small class="text-center">(The URL on the site that contains the postal address used to determine that the site is in the UK)</small></label>
						    <div class="col-sm-6">
		 						<input type="text" name="field_uk_postal_address_url" value="@form.get.ukPostalAddressUrl" size="60" maxlength="2048" class="form-control" />
							</div>
						</div>
					</div>
		     	</div>
		     	
				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Via Correspondence <small class="text-center">(Previous correspondence with the web site owner by a Curator contains evidence of a UK address)</small></label>
						    <div class="col-sm-6">
				                @if(form.get.viaCorrespondence != null && form.get.viaCorrespondence) {             
					                <input type="checkbox" name="field_via_correspondence" value="true" checked/>
				                } else {
					                <input type="checkbox" name="field_via_correspondence" value="true" />
				                }
							</div>
						</div>
					</div>
		     	</div>		

				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Via Correspondence: Notes <small class="text-center">(Please record details of correspondence with site owner)</small></label>
						    <div class="col-sm-6">
		 						<textarea name="field_notes" cols="100" rows="1" class="form-control">@form.get.value</textarea>
							</div>
						</div>
					</div>
		     	</div>	

				@if(user.hasRole("sys_admin") || user.hasRole("archivist") || user.hasRole("expert_user")) {
				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Professional Judgement <small class="text-center">(In your professional judgement, does this site qualify as a UK Publication under the terms of the Legal Deposit Legislation. Please provide details of evidence used in the box below)</small></label>
						    <div class="col-sm-6">
				                @if(form.get.professionalJudgement != null && form.get.professionalJudgement) {             
					                <input type="checkbox" name="field_professional_judgement" value="true" checked/>
				                } else {
					                <input type="checkbox" name="field_professional_judgement" value="true" />
				                }
							</div>
						</div>
					</div>
		     	</div>	
		     	
				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Professional Judgement Explanation <small class="text-center">(Please describe the rational behind this decision, indicating any evidence used)</small></label>
						    <div class="col-sm-6">
			 					<textarea name="field_professional_judgement_exp" cols="100" rows="1" class="form-control">@form.get.professionalJudgementExp</textarea>
							</div>
						</div>
					</div>
		     	</div>	
		     	}

				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">No LD Criteria Met <small class="text-center">(Use this to indicate that no LD criteria apply, and so this site cannot be archived under Legal Deposit)</small></label>
						    <div class="col-sm-6">
				                @if(form.get.noLdCriteriaMet != null && form.get.noLdCriteriaMet) {             
					                <input type="checkbox" name="field_no_ld_criteria_met" value="true" checked/>
				                } else {
				                	<input type="checkbox" name="field_no_ld_criteria_met" value="true" />
				                }
	                		</div>
						</div>
					</div>
		     	</div>	
	        </div>
	        
	        <div class="tab-pane fade" id="crawlpolicy">

				@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Scope <small class="text-center">(Select the scope of the crawl around this URL. In general, when nominating a site for crawling, you should specify the homepage and say 'All URLs that start like this'. If you wish to include all subdomains (e.g. example.co.uk but also anything like www.example.co.uk, images.example.co.uk, etc.) then select the 'any subdomains' option)</small></label>
						    <div class="col-sm-6">
								<select name="field_scope" id="field_scope" class="form-control">
					                @for(scopeType <- scopeTypes) {
						                @if(form.get.scope != null && form.get.scope.equals(scopeType.name)) {
						                	<option value="@scopeType.name" selected>@scopeType.getValue</option>
						                } else {
						                	<option value="@scopeType.name">@scopeType.getValue</option>
						                }
					                }
								</select>
							</div>
						</div>
					</div>
		     	</div>
		     	
				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Depth <small class="text-center">(Use this to indicate that no LD criteria apply, and so this site cannot be archived under Legal Deposit)</small></label>
						    <div class="col-sm-6">
								<select name="field_depth" id="field_depth" class="form-control">
					                @for(depthType <- depthTypes) {
						                @if(form.get.depth != null && form.get.depth.equals(depthType.name)) {
						                	<option value="@depthType.name" selected>@depthType.getValue</option>
						                } else {
						                	<option value="@depthType.name">@depthType.getValue</option>
						                }
					                }
								</select>
	                		</div>
						</div>
					</div>
		     	</div>	

				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Ignore Robots.txt <small class="text-center">(Should we ignore Robots.txt while crawling this site? Note that although this may lead to us exploring more crawler traps, this does not present much of a problem to our crawling systems)</small></label>
						    <div class="col-sm-6">
				                @if(form.get.ignoreRobotsTxt != null && form.get.ignoreRobotsTxt) {             
					                <input type="checkbox" name="field_ignore_robots_txt" value="true" checked />
				                } else {
					                <input type="checkbox" name="field_ignore_robots_txt" value="true"/>
				                }
	                		</div>
						</div>
					</div>
		     	</div>	
		     	
				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Crawl Frequency<span class="form-required" title="This field is required."></span> <small class="text-center">(How often should this site be archived?)</small></label>
						    <div class="col-sm-6">
				 				<select id="edit-field-crawl-frequency-und" name="field_crawl_frequency" class="form-control">
					                @for(crawlFrequency <- crawlFrequencies) {
						                @if(form.get.crawlFrequency != null && form.get.crawlFrequency.equals(crawlFrequency.name)) {
						                	<option value="@crawlFrequency.name" selected>@crawlFrequency.getValue</option>
						                } else {
						                	<option value="@crawlFrequency.name">@crawlFrequency.getValue</option>
						                }
									}
				 				</select>
				 			</div>
						</div>
					</div>
		     	</div>	
		     	
				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Start date</label>
						    <div class="col-sm-6">
		 						<input type="text" name="field_crawl_start_date" value="@form.get.crawlStartDate" size="30" maxlength="2048" class="form-control" id="start-date"/>
	                		</div>
						</div>
					</div>
		     	</div>	

				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">End date</label>
						    <div class="col-sm-6">
		 						<input type="text" name="field_crawl_end_date" value="@form.get.crawlEndDate" size="30" maxlength="2048" class="form-control" id="end-date"/>
	                		</div>
						</div>
					</div>
		     	</div>	

				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">White list</label>
						    <div class="col-sm-6">
		 						<input type="text" name="white_list" value="@form.get.whiteList" size="30" maxlength="2048" class="form-control" />
	                		</div>
						</div>
					</div>
		     	</div>	

				<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Black list</label>
						    <div class="col-sm-6">
		 						<input type="text" name="black_list" value="@form.get.blackList" size="30" maxlength="2048" class="form-control" />
	                		</div>
						</div>
					</div>
		     	</div>	
		     			     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label"></label>
						    <div class="col-sm-6">
								@if(form.get != null) {
									@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
								<button type="submit" name="archive" class="btn btn-success">Archive this now</button>
									}
								} else {
								<button disabled type="submit" name="archive" class="btn btn-success">Archive this now</button>
								<div class="padding-20">
									<div class="alert alert-info">
										Before you can archive this target, you need to save the target record.
									</div>
								</div>
								}
							</div>
						</div>
					</div>
		     	</div>
				}		     	
	        </div>
	        
	        <div class="tab-pane fade" id="licensing">
			
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="edit-field-license-und" class="col-sm-6 control-label">License <small class="text-center">(The license terms under which this site is archived and made available)</small></label>
						    <div class="col-sm-6">
					    	    @if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
									@if(form.get.qaIssue != null) { 
									    @if(form.get.qaIssue.id == -1) { 
											<select multiple name="license" id="edit-field-license" class="form-control" size="2">
										} else {
										    @if(user.hasRole("sys_admin")) {
												<select name="license" id="edit-field-license" class="form-control" size="2">
											} else {
												<select name="license" id="edit-field-license" class="form-control" size="2" disabled>
											}
										}
									} else {
									<select name="license" id="edit-field-license" class="form-control" size="2" disabled>
									}
								}
									<option>None</option>
								    @for(license <- licenses) {
						                @if(form.get.licenses.contains(license)) {             
										 	<option value="@license.id" selected>@license.name</option>
									 	} else {
										 	<option value="@license.id" >@license.name</option>
									 	}									 	
								    }	
								</select>
							</div>
						</div>
					</div>
		     	</div>	

				@if(form.get.indicateUkwaLicenceStatus) {    	
					<div class="padding-20">
						<div class="alert alert-info">
							NB. There is already a licence request either pending, or granted, or refused, for a target at a higher level in this domain. There is no need to request another one.
							@for(target <- form.get.getUkwaLicenceStatusList) { 
								<p><a href="@routes.TargetController.view(target.id)">@target.title @target.fieldUrl()</a></p>
							}
						</div>
					</div>	
				}	     			     	
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">Open UKWA license requests <small class="text-center">(This shows the current status of any requests to site owners for Open UKWA licences. If this has not yet been initiated, you can begin the process using the 'Open License Request' button)</small></label>
						    <div class="col-sm-6">
						        @if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
								<select name="qa_status" id="qa_status" class="form-control">
								} else {
								<select disabled name="qa_status" id="qa_status" class="form-control">
								}
									<option>None</option>
					                @for(status <- crawlPermissionStatuses) {
						                @if(status.equals(form("qaStatus").value)) {
						                	<option value="@status.name" selected>@status.getValue</option>
						                } else {
						                	<option value="@status.name" >@status.getValue</option>
						                }
					                }
								</select>
							</div>
						</div>
					</div>
		     	</div>
		     	
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label"></label>
						    <div class="col-sm-6">
								@if(form.get != null && form.get.qaIssue != null && form.get.qaIssue == -1) {
									@if(!form.get.indicateLicenses) {
										<button type="submit" name="request" class="btn btn-success">Open License Request</button>
									}
									@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
								   		<a href="@routes.CrawlPermissionController.showCrawlPermissions(form.get.url)">Crawl Permissions</a>
								   	}
								} else {
								<button disabled type="submit" name="request" class="btn btn-success">Open License Request</button>
								<div class="padding-20">
									<div class="alert alert-info">
										Before you can request an Open UKWA license, you need to save the target record. You cannot open a new licence request if a request is already queued.
									</div>
								</div>
								}
							</div>
						</div>
					</div>
		     	</div>
		     	
			</div>		     		        		     
	        
		</div>
                        
        <div id="archivistArea" class="revision">
    		<div class="row padding-10">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="form-group">
						<label class="col-sm-6 control-label">Archivist Notes <small class="text-center">(This field should include any information provided by curators justifying the creation of the record. This field is NOT public.)</small></label>
					    <div class="col-sm-6">
			            	<textarea class="form-control" name="archivist_notes" id="input_archivist_notes" value="@form.get.archivistNotes">@form.get.archivistNotes</textarea>
						</div>
					</div>
				</div>
	     	</div>	
		</div>

        <div id="revisionArea" class="revision">
    		<div class="row padding-10">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="form-group">
		              	<label for="inputBody" class="col-sm-6 control-label">Revision log message</label>
					    <div class="col-sm-6">
               				<textarea class="form-control" name="revision" id="inputRevision">@form.get.revision</textarea>
						</div>
					</div>
				</div>
	     	</div>
		</div>

		<div class="padding-20">
			<div class="panel-group" id="accordion">
				<div class="panel panel-primary" id="panels">
					<div class="panel-heading">
				    	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseInstances" style="color:#fff;">
				        	Instances
						</a>
					</div>
					<div id="collapseInstances" class="panel-collapse collapse">
						@for(fieldUrl <- form.get.fieldUrls) {
							<div class="panel-footer">
								<a class="brand" target="_blank" href="http://opera.bl.uk:8080/wayback/*/@fieldUrl.url">In QA Wayback</a>
							</div>
						    <div class="panel-footer">
					        	<a class="brand" target="_blank" href="http://www.webarchive.org.uk/wayback/archive/*/@fieldUrl.url">In Open UK Web Archive</a>
							</div>
							<div class="panel-footer">
								<a class="brand" target="_blank" href="http://www.webarchive.org.uk/mementos/search/@fieldUrl.url">In other web archives</a>
							</div>
						    <div class="panel-footer">
					        	<a class="brand" target="_blank" href="@fieldUrl.url">Live site</a>
							</div>
						}
					</div>
				</div>
			</div>
		</div>
		
		<div class="padding-20">
			<div class="alert alert-info">
				Provide an explanation of the changes you are making. This will help other authors understand your motivations.
			</div>
		</div>

		@if(user.hasRole("sys_admin") || user.hasRole("archivist") || user.hasRole("expert_user") || user.hasRole("user")) {     			     		
			<div class="row padding-10 pull-right">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="btn-group">
					    @if(form.get.authorUser != null && user.hasRole("user") 
					    	&& !user.hasRole("expert_user") 
					    	&& !user.hasRole("archivist") 
					    	&& !user.hasRole("sys_admin") 
					    	&& user.id != form.get.authorUser.id) { 
							<button type="submit" class="btn btn-primary" name="save" id="edit-save" disabled>Save</button>
							@if(form.get != null) {
								<button type="submit" class="btn btn-primary" name="delete" onclick="return confirm('Are you sure?');" id="delete" disabled>Delete</button>
							}
						} else {
							<button type="submit" class="btn btn-primary" name="save" id="edit-save">Save</button>
					       	@if(form.get != null) {
								<button type="submit" class="btn btn-primary" name="delete" onclick="return confirm('Are you sure?');" id="delete">Delete</button>
						   	}
						}
			       </div>
				</div>
			</div>
		}
	}
}
