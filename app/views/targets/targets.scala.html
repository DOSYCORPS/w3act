@(title: String, user: User, targets: List[Target], curators: List[User], organisations: List[Organisation], curatorUrl: String, organisationUrl: String, collectionCategoryUrl: String, subjectUrl: String, crawlFrequency: String, depth: String, scope: String, offset: Int, limit: Int, filterUrl: String, license: String, sorted: Boolean)

@pagination = {
	<div class="text-center">
		<ul class="pagination">
			@if(Targets.checkPrev(offset)) {
				<li>
					<a class="page" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
						subjectUrl, crawlFrequency, depth, scope, Targets.getPrev(Targets.getStartPage(offset)), limit, license, sorted)">Prev</a>
				</li>
	         }
	         @for(i <- Targets.getRange(Targets.getStartPage(offset))) {
	             @if(Targets.checkNext(i, limit)) {
					<li>
						<a class="page" @if(offset==i){style="color:red";}" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
							subjectUrl, crawlFrequency, depth, scope, i, limit, license, sorted)">@(i+1)</a>
					</li>
	             }
	         }
	         @if(Targets.checkNext(offset+Targets.getPaginationOffset(), limit)) {
	         <li>
				<a class="page" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
	           		subjectUrl, crawlFrequency, depth, scope, Targets.getNext(Targets.getStartPage(offset)), limit, license, sorted)">Next</a>
	         </li>
	         }
	         <li>
				<a class="page" href="@routes.Targets.edit(curatorUrl, organisationUrl, collectionCategoryUrl, 
					subjectUrl, crawlFrequency, depth, scope, Targets.getMaxPageNumber(limit)-1, limit, license, sorted)">
	           		@Targets.getMaxPageNumber(limit)</a>
	         </li>
		</ul>
		<!--p>Displayed page @(offset+1) from @Targets.getMaxPageNumber(limit)</p-->
	</div>
}

@script = {
    <script src="@routes.Assets.at("javascripts/search.js")" type="text/javascript"></script>
	<script>
		$(document).ready(function() {
             context = @play.api.Play.current.configuration.getString("application.context");
             scopeCheck(context);
		});
	</script>
}

@main(title, user, script) {
	<div class="page-header">
	    <h1>Targets overview</h1>
	</div>	    
    <article class="targets">
    	<div id="forms">
			<form class="form-horizontal" action="@routes.Targets.filterUrl()" method="POST" role="form">
	   			<div class="input-group">
					<input class="form-control" id="search-query" name="filter" type="text" id="filter" value="@filterUrl">
		   			<span class="input-group-btn">
				        <button type="submit" class="btn btn-primary" id="search" name="search" title="Red color means that URL is not in scope, green color means that URL is in scope">Search</button>	
				        <button type="submit" class="btn btn-primary" name="clear" title="Clear up search settings">Clear</button>
						@if(user.hasRole("sys_admin") || user.hasRole("archivist")) {
							<!--  form class="filter-form" action="@routes.LookUp.index()" method="GET" -->
							<!--  button onclick="location.href='@routes.LookUp.index()'" type="submit" class="btn btn-success" title="Look up and add new target">Add new target</button -->
							<a href="@routes.LookUp.index()" id="addentry" name="addentry" class="btn btn-primary" title="Look up and add new target">Add new target</a>
							<!-- /form -->
						}
					</span>	
	            </div>
			<div class="alert alert-info">
				Search here for all or part of the name of the target, or its URL.
			</div>

				<div class="padding-20">
					<a data-toggle="collapse" data-parent="#accordion" href="#filter-panel">
						<span id="toggle">&#9660; Filters &#9650;</span>
					</a>
				</div>
						
				<div id="accordion">
					<div id="filter-panel" class="panel-collapse collapse">
						<div class="panel-body">
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
										<label for="curator" class="col-sm-6 control-label">Filter by curator</label>
									    <div class="col-sm-6">
											<select name="author" class="form-control" id="curator">
												<option>None</option>
												@for(curator <- User.findAll()) {
													@if(curatorUrl != null && curatorUrl.equals(curator.url)) {
														<option selected>@curator.name</option>
													} else {
														<option>@curator.name</option>
													}
												}
											</select>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">					
						            	<label for="organisation" class="col-sm-6 control-label">Filter by nominating organisation</label>
						            	<div class="col-sm-6">
											<select name="field_nominating_organisation" class="form-control" id="organisation">
									        	<option>None</option>
									            	@for(organisation <- Organisation.findAll()) {
							                 		  		@if(organisationUrl != null && organisationUrl.equals(organisation.url)) {
								                			<option selected>@organisation.title</option>
								                		} else {
								                			<option>@organisation.title</option>
								                		}
									                }
											</select>
										</div>
						         	</div>
								</div>
							</div>
		
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
						            	<label for="subject" class="col-sm-6 control-label">Filter by subject</label>
						            	<div class="col-sm-6">
											<select name="field_subject" class="form-control" id="subject">
									        	<option>None</option>
									            @for(subject <- Taxonomy.findListByType("subject")) {
							                 			@if(subjectUrl != null && subjectUrl.equals(subject.url)) {
							                			<option selected>@subject.name</option>
							                		} else {
														<option>@subject.name</option>
								                		}
									                }
											</select>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">					
						            	<label for="frequency" class="col-sm-6 control-label">Filter by crawl frequency</label>
						            	<div class="col-sm-6">
											<select name="field_crawl_frequency" class="form-control" id="frequency">
								                <option>None</option>
								                @for(curCrawlFrequency <- Targets.getCrawlFrequency()) {
						                 		  		@if(crawlFrequency != null && crawlFrequency.equals(curCrawlFrequency.field_crawl_frequency)) {
							                		<option selected>@curCrawlFrequency.field_crawl_frequency</option>
							                		} else {
							                		<option>@curCrawlFrequency.field_crawl_frequency</option>
							                		}
								                }
											</select>
										</div>
						         	</div>
								</div>
							</div>
		
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
						            	<label for="field-depth" class="col-sm-6 control-label">Filter by depth</label>
						            	<div class="col-sm-6">
											<select name="field_depth" class="form-control" id="field-depth">
									        	<option>None</option>
									            @for(curDepth <- Targets.getDepth()) {
							                  		@if(depth != null && depth.equals(curDepth.field_depth)) {
									                	<option selected>@curDepth.field_depth</option>
									                } else {
									                	<option>@curDepth.field_depth</option>
									                }
												}
											</select>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">
						            	<label for="license" class="col-sm-6 control-label">Filter by license</label>
						            	<div class="col-sm-6">
											<select name="field_license" class="form-control" id="license">
									        	<option>None</option>
									            @for(curLicense <- Targets.getLicense()) {
							                 			@if(license != null && license.equals(curLicense.name)) {
								                		<option selected>@curLicense.name</option>
								                	} else {
								                		<option>@curLicense.name</option>
								                	}
												}
											</select>
										</div>
						         	</div>
								</div>
							</div>
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
						            	<label for="scope" class="col-sm-6 control-label">Filter by scope</label>
						            	<div class="col-sm-6">
											<select name="field_scope" class="form-control" id="scope">
									        	<option>None</option>
									            @for(curScope <- Targets.getScope()) {
							                 		@if(scope != null && scope.equals(curScope.field_scope)) {
								                		<option selected>@curScope.field_scope</option>
													} else {
								                		<option>@curScope.field_scope</option>
								                	}
												}
											</select>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">
							        	<form action="@routes.Targets.export(curatorUrl, organisationUrl, collectionCategoryUrl, subjectUrl, crawlFrequency, depth, scope, license, filterUrl, offset, sorted)" method="POST">
							  				<label for="export" class="col-sm-6 control-label">Targets count</label>
							            	<div class="col-sm-6">
									   			<div class="input-group">
									 				<input type="text" name="count" value="@limit" maxlength="200" class="form-control" disabled id="export" title="Number of selected targets" />
									 				<span class="input-group-btn">
								            			<button type="submit" class="btn btn-primary" id="export" name="export" title="Export results of filtered searches and reports to CSV file">Export</button>
								            		</span>
								            	</div>
								            </div>
											<input type="hidden" name="offset" value="@offset">
											<input type="hidden" name="limit" value="@limit">
							                <input type="hidden" name="csv" value="@targets">
						                </form>
									</div>
								</div>
							</div>
							
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
										<div class="row padding-10">
											<label class="col-sm-6 control-label">Sort alphabetically</label>
										    <div class="col-sm-6">
						                 		@if(sorted != null && sorted) {
								                <input type="checkbox" name="sorted" value="true" checked/>
								                } else {
								                <input type="checkbox" name="sorted" value="true"/>
								                }
											</div>
								     	</div>	 
								     </div>
								 </div>
						    </div>
		     	
						</div>
					</div>
				</div>
			</form>	
		</div>
		
	    <div>
	    	<div>@pagination</div>
			<!--script >
				$(function() {
				$("table#targetstable").tablesorter({ sortList: [[1,0]] });
				});
			</script>
			<table id="targetstable" class="tablesorter table table-striped table-bordered table-condensed zebra-striped"-->
			<table class="table table-hover">
				<thead>
	                <tr>
						<!--<th>#</th>-->
						<th>Target name</th>
						<th>Target URL</th>
	                </tr>
				</thead>
				<tbody>
	              	@targets.map { target =>		              
	                <tr>
						<!--<td>@target.nid</td>-->
						@if(target.url != null && target.title != null) {
							<td><a href="@routes.TargetEdit.view(target.url)">@target.title</a></td>
						} else {
							<td></td>
						}		                  
						<!--<td><a href="@target.url">@target.title</a></td>-->
						<td><a class="brand" href="@target.get_field_list_as_str("field_url")">@target.get_field_list_as_str("field_url")</a></td>
	                </tr>
	                }
				</tbody>
			</table>
	    	<div>@pagination</div>
		</div>
   	</article>
}

