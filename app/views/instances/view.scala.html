@(instance: Instance, user: User)

@script = {
	<script>
		(function () {
			var query = window.location.search.substring(1);
			var tab = getQueryVariable('tab');
			
			setTimeout(function(){
				//alert('instance view tab: ' + tab);
				if (tab == 'qa') {
	  			  $('#li-overview').removeClass('active'); // Remove 'active' from #overview tab
				  $('#li-qa').addClass('active'); // Set 'active' #qa tab		  
				  $('#overview').removeClass('active in');
				  $('#qa').addClass('active in');
				}
			}, 1);
		})();
		
		// sample URL: http://www.webarchive.org.uk/actdev/instance/act-13790?tab=qa
		function getQueryVariable(variable) {
		    var query = window.location.search.substring(1);
		    var vars = query.split('&');
		    for (var i = 0; i < vars.length; i++) {
		        var pair = vars[i].split('=');
		        if (decodeURIComponent(pair[0]) == variable) {
		            return decodeURIComponent(pair[1]);
		        }
		    }
		    console.log('Query variable %s not found', variable);
		}
		
	    function switchPage() {
	        var activeTab = $('#myNavbar li.active'); // Here we grab the li that's currently marked as 'active'
	        var href = activeTab.find('a').attr('href'); // here we grab the href of the link inside the active tab
	        
	        // And finally we just attach the href to view.html and forward the browser. 
	        // An example URL would be: 'view.html#npld-scope'
	        window.location.href="@routes.InstanceController.edit(instance.id)" + href;
	      }
	    
	      $(document).ready(function() {
	        // This happens right after the document is loaded.
	        // Our nav pills won't do anything by themselves, so we need to make sure we
	        // check if the current URL has a #-component and if so, we activate the
	        // appropriate pill.
	        var hash = window.location.hash;
	        if (hash.indexOf('#') == 0) {
	          // We have a hash - let's see if it matches with nav pill href
	          var el = $('#myNavbar a[href=' + hash + ']');
	        
	          // We have an <a> with this ID, and it has a parent node that's an <li>
	          if (el && el.parent() && el.parent().prop('tagName') == 'LI') {
	            // So we activate this nav pill
	            $(el).tab('show');
	            window.scrollTo(0, 0);
	          }
	        }
	        
	        // This is completely optional!! But it keeps the hash in our current URL bar
	        // in sync with the tab we have selected, so the pages stay nice and bookmarkable
	        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
	          window.location.hash = ($(e.target).attr('href'));
	          window.scrollTo(0, 0);
	        })
	      });	
	</script>
}

@main("", user, script) {

   	<div class="page-header">
	    <h1><a href="@routes.InstanceController.index()">Targets > Instances > </a>Instance @instance.title</h1>
	</div>
	
	<ul class="nav nav-tabs">
	   <li class="active"><a href="#">View</a></li>
	   <li><a onclick="switchPage(); return false;" href="@routes.InstanceController.edit(instance.id)">Edit</a></li>
	</ul>
	
	<div class="tab-content padding-20">
		<input type="hidden" name="id" value="@instance.id">
        <input type="hidden" name="user" value="@user.url">
           
		<ul class="nav nav-pills" id="myNavbar">
		    <li class="active" id="li-qa"><a href="#qa" data-toggle="tab">QA</a></li>
        	<li id="li-overview"><a href="#overview" data-toggle="tab">Overview</a></li>
        	<li class=""><a href="#metadata" data-toggle="tab">Metadata</a></li>
	        <li><a href="#crawlpermission" data-toggle="tab">NPLD scope 
			@if(instance.target.isInScopeAll()) {
				<font color="green">(+)</font>
			} else {
				<font color="red">(-)</font>
			}		                
			</a></li>
        	<li class=""><a href="#crawlpolicy" data-toggle="tab">Crawl policy and Schedule</a></li>
		    <li class=""><a href="#licensing" data-toggle="tab">UKWA Licensing</a></li>
      	</ul>
	</div>
	
	<div id="myTabContent" class="tab-content">
		
		<div class="tab-pane padding-20 fade active in" id="qa">    	
    		<div class="row padding-10">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="form-group">
		            	<label for="qa_status" class="col-sm-6 control-label">QA Status</label>
		            	<div class="col-sm-6">
					        @if(instance.qaIssue.name != null && instance.qaIssue.name.length() > 0) {
								@instance.qaIssue.name
							} else {
							    <p>none</p>
							}
						</div>
		         	</div>
				</div>
			</div>

    		<div class="row padding-10">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="form-group">
		            	<label for="qa_issue_category" class="col-sm-6 control-label">QA Issue Category</label>
		            	<div class="col-sm-6">
		            		@instance.qaIssueCategory
						</div>
		         	</div>
				</div>
			</div>

    		<div class="row padding-10">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="form-group">
		            	<label for="qa_notes" class="col-sm-6 control-label">QA Notes</label>
		            	<div class="col-sm-6">
			            	<textarea class="form-control" name="qa_notes" id="qa_notes" cols="100" rows="1" value="@instance.qaNotes" readonly>@instance.qaNotes</textarea>
						</div>
		         	</div>
				</div>
			</div>

    		<div class="row padding-10">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="form-group">
		            	<label for="quality_notes" class="col-sm-6 control-label">Technical Notes</label>
		            	<div class="col-sm-6">
			            	<textarea class="form-control" name="quality_notes" id="quality_notes" cols="100" rows="1" value="@instance.notes" readonly>@instance.notes</textarea>
						</div>
		         	</div>
				</div>
			</div>	

    		<div class="row padding-10">
	     		<div class="col-md-12 col-xs-12 col-sm-12">
					<div class="form-group">
						<label for="inputUrls" class="col-sm-6 control-label">
							@if(instance.target.fieldUrl() != null && instance.target.fieldUrl().length > 0) {
							<br><a href="@routes.InstanceController.index()/list/?s=title&f=@instance.target.fieldUrl()">all instances for the target</a>
							}
						</label>
					</div>
				</div>
	     	</div>	 		     	    				
		</div>

		<div class="tab-pane padding-20 fade" id="overview">
	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputTitle" class="col-sm-6 control-label">Title <font color="red">*</font></label>
						    <div class="col-sm-6">
				              <input class="form-control" name="title" id="inputTitle" size="60" placeholder="My title" type="text" value="@instance.title" readonly>
							</div>
						</div>
					</div>
		     	</div>

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label class="col-sm-6 control-label">ID <font color="red">*</font></label>
						    <div class="col-sm-6">
								<input class="form-control" name="nid" value="@instance.id" size="30" readonly>
							</div>
						</div>
					</div>
		     	</div>

	    		<div class="row padding-10">
		     		<div class="col-md-12 col-xs-12 col-sm-12">
						<div class="form-group">
							<label for="inputUrls" class="col-sm-6 control-label">
								Seed URL(s) <font color="red">*</font> 
								<small class="text-center">(One or more URLs, separated by comma)</small>
								@if(instance.target.fieldUrl() != null && instance.target.fieldUrl().length > 0) {
								<br><a href="@routes.InstanceController.index()/list/?s=title&f=@instance.target.fieldUrl()">all instances for the target</a>
								}
							</label>
						    <div class="col-sm-6">
								<input class="form-control" name="fieldurl" id="fieldurl" placeholder="url1, url2" type="text" value="@instance.target.fieldUrl()" readonly>
							</div>
						</div>
					</div>
		     	</div>	 
		     	    	
		</div>
	</div>
	<hr>
	<div id="revisionArea" class="revision">
		<dl class="dl-horizontal">
			<dt>Revision log message:</dt>
			<dd>@instance.revision</dd>
		</dl>
	</div>
		
	<div class="padding-20">
		<div class="panel-group" id="accordion">
			<div class="panel panel-primary" id="panels">
				<div class="panel-heading">
			    	<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseInstances" style="color:#fff;">
			        	Instances
					</a>
				</div>
				<div id="collapseInstances" class="panel-collapse collapse">
					@for(fieldUrl <- instance.target.fieldUrls) {
						<div class="panel-footer">
							<a class="brand" target="_blank" href="http://opera.bl.uk:8080/wayback/*/@fieldUrl.url">In QA Wayback</a>
						</div>
					    <div class="panel-footer">
				        	<a class="brand" target="_blank" href="http://www.webarchive.org.uk/wayback/archive/*/@fieldUrl.url">In Open UK Web Archive</a>
						</div>
						<div class="panel-footer">
							<a class="brand" target="_blank" href="http://www.webarchive.org.uk/mementos/search/@fieldUrl.url">In other web archives</a>
						</div>
					    <div class="panel-footer">
				        	<a class="brand" target="_blank" href="@fieldUrl.url">Live site</a>
						</div>
					}
				</div>
			</div>
		</div>
	</div>
	
	<div class="padding-20">
		<div class="panel-group" id="accordion">
			<div class="panel panel-primary" id="panels">
				<div class="panel-heading">
	  				<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseRevisions" style="color:#fff;">
	      				Instance revisions
	      			</a>
	      		</div>
				<div id="collapseRevisions" class="panel-collapse collapse">
	       			@for(prevInstance <- Instance.findRevisions(instance.url)) {
	       			<div class="panel-footer">
	       				<a class="brand" href="@routes.InstanceController.viewrevision(prevInstance.id)">
	         				(@prevInstance.id) &nbsp; @prevInstance.revision &nbsp; @prevInstance.updatedAt</a>
	       			</div>
	       			}
	     		</div>
	    	</div>
		</div>
	</div>    
   		
}
